# 单容器部署配置（覆盖默认的多容器模式）
#
# 使用方式:
#   docker compose -f docker-compose.single.yml up -d
#
# 优点:
#   - 只需一个容器，内存占用更低
#   - 部署简单，适合开发测试
#   - 服务间通信无网络开销

services:
  dbmanager:
    build:
      context: .
      target: all-in-one
    image: dbmanager/all-in-one:latest
    ports:
      - "8080:8080"   # Gateway
      - "8081:8081"   # Connection Service
      - "8082:8082"   # Query Service
      - "8083:8083"   # AI Service
    environment:
      - RUST_LOG=info
      - LLM_BASE_URL=${LLM_BASE_URL:-https://api.openai.com/v1}
      - LLM_API_KEY=${LLM_API_KEY:-}
      - LLM_DEFAULT_MODEL=${LLM_DEFAULT_MODEL:-gpt-4o-mini}
      - MAX_CONNECTIONS=10
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 128M
    restart: unless-stopped
